
# üì¶ OzonDomParser

–£—Ç–∏–ª–∏—Ç–∞ –Ω–∞ PHP –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–≤–∞—Ä–∞—Ö —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ Ozon.ru —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º DOMDocument –∏ XPath.

## ‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ü–†–ò–ú–ï–ß–ê–ù–ò–ï

Ozon –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ–∂–Ω—ã–µ **–∞–Ω—Ç–∏-–±–æ—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã**, –≤–∫–ª—é—á–∞—è —Ü–∏–∫–ª—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –ø—Ä–æ–≤–µ—Ä–∫—É –∫—É–∫–∏, Gzip-—Å–∂–∞—Ç–∏–µ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É IP-–∞–¥—Ä–µ—Å–æ–≤. –î–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –¥–ª—è –æ–±—Ö–æ–¥–∞ —ç—Ç–∏—Ö –±–∞–∑–æ–≤—ã—Ö –º–µ—Ä (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫—É–∫–∏, —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞–º –∏ –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞), –Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–≥–æ —Å–∫—Ä–µ–π–ø–∏–Ω–≥–∞ **–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–æ—Ç–∏—Ä—É–µ–º—ã—Ö –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤**.

-----

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

  * PHP (–≤–µ—Ä—Å–∏—è 7.0 –∏–ª–∏ –≤—ã—à–µ)
  * –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ PHP **cURL** (–¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤)
  * –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ PHP **DOM** (–¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML)

### –û—Å–Ω–æ–≤–Ω–æ–π –ö–æ–¥ –ü–∞—Ä—Å–µ—Ä–∞

–ö–ª–∞—Å—Å `OzonDomParser` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–µ –ø–æ –µ–≥–æ SKU.

```php
<?php

class OzonDomParser
{
    // ... (–ü–æ–ª–Ω—ã–π –∫–æ–¥ –∫–ª–∞—Å—Å–∞, –≤–∫–ª—é—á–∞—è –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è cURL –∏ –∫—É–∫–∏) ...

    private $userAgent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36';

    // ... (–ú–µ—Ç–æ–¥—ã parseBySku, parseProductPage –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã) ...
}
```

### –ü—Ä–∏–º–µ—Ä –ó–∞–ø—É—Å–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–≤–∞—Ä–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑–æ–≤–∏—Ç–µ –º–µ—Ç–æ–¥ `parseBySku`, –ø–µ—Ä–µ–¥–∞–≤ –µ–º—É –∞—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞ (SKU).

```php
// –í–∫–ª—é—á–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –¥–ª—è —É–¥–æ–±–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
error_reporting(E_ALL);
ini_set('display_errors', 1);

$parser = new OzonDomParser();
$sku = '2102536131'; // –í–∞—à –∞—Ä—Ç–∏–∫—É–ª Ozon –¥–ª—è —Ç–µ—Å—Ç–∞

echo "--- –ù–∞—á–∏–Ω–∞—é –ø–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–∞ —Å OZON SKU: {$sku} ---" . PHP_EOL;

try {
    $data = $parser->parseBySku($sku);

    echo '<pre>';
    print_r($data);
    echo '</pre>';
} catch (Exception $e) {
    echo '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ',  $e->getMessage(), "\n";
}
```

-----

## üí° –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –î–∞–Ω–Ω—ã—Ö

–ú–µ—Ç–æ–¥ `parseProductPage` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–ª—é—á–∞–º–∏:

| –ö–ª—é—á | –û–ø–∏—Å–∞–Ω–∏–µ | –ú–µ—Ç–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞ |
| :--- | :--- | :--- |
| `–ù–∞–∑–≤–∞–Ω–∏–µ` | –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (`<h1>`). | `parseTitleWithXPath` |
| `–ö–∞—Ç–µ–≥–æ—Ä–∏—è` | –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `/`. | `parseCategoryWithXPath` |
| `–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è`| –ú–∞—Å—Å–∏–≤ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (1000px). | `parseImagesWithXPath` |
| `–û–ø–∏—Å–∞–Ω–∏–µ` | –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ –±–ª–æ–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è. | `parseDescriptionWithXPath` |
| `–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏`| –ê—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –ø–∞—Ä "–ö–ª—é—á =\> –ó–Ω–∞—á–µ–Ω–∏–µ". | `parseCharacteristicsWithXPath` |
| `–¢–∏–ø` | –ò–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ –æ–±—â–µ–≥–æ –º–∞—Å—Å–∏–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫. | |
| `–°—Ç—Ä–∞–Ω–∞-–∏–∑–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å` | –ò–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ –æ–±—â–µ–≥–æ –º–∞—Å—Å–∏–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫. | |
| `–ü–∞—Ä—Ç–Ω–æ–º–µ—Ä –∏–ª–∏ –ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è` | –ò–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ –æ–±—â–µ–≥–æ –º–∞—Å—Å–∏–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (`–ü–∞—Ä—Ç–Ω–æ–º–µ—Ä` –∏–ª–∏ `–ê—Ä—Ç–∏–∫—É–ª`).| |

-----

## üõ†Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –û—Ç–ª–∞–¥–∫–∞ cURL

–ö–ª–∞—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç cURL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —É—á–µ—Ç–æ–º —Ä—è–¥–∞ –ø—Ä–æ–±–ª–µ–º, –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ—Ç–ª–∞–¥–∫–∏:

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ –≤ –∫–æ–¥–µ |
| :--- | :--- |
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ / –†–µ–¥–∏—Ä–µ–∫—Ç-–ª–æ–≤—É—à–∫–∞** | `CURLOPT_FOLLOWLOCATION => true` –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∫—É–∫–∏. |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ (–ö—É–∫–∏)** | `CURLOPT_COOKIEJAR` –∏ `CURLOPT_COOKIEFILE` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–º–µ–Ω–∞ –∫—É–∫–∞–º–∏. |
| **–°–∂–∞—Ç–∏–µ (Gzip)** | `CURLOPT_ENCODING => ''` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. |
| **User-Agent** | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ `User-Agent` (`$this->userAgent`). |

–ï—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω–µ—Ç–µ—Å—å —Å –æ—à–∏–±–∫–æ–π **"–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω"**:

1.  **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ XPath:** Ozon —á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç –∫–ª–∞—Å—Å—ã. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–∏ XPath-–∑–∞–ø—Ä–æ—Å—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã –¥–ª—è HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞.
2.  **–°–º–µ–Ω–∏—Ç–µ IP:** –í–µ—Ä–æ—è—Ç–Ω–æ, –≤–∞—à IP-–∞–¥—Ä–µ—Å –±—ã–ª –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä** –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å —Å –¥—Ä—É–≥–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞.
